<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Editor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #fafafa;
            --bg-tertiary: #f0f0f0;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --text-muted: #a0aec0;
            --border: #e2e8f0;
            --accent: #3182ce;
            --accent-hover: #2c5282;
            --shadow: 0 1px 3px rgba(0,0,0,0.05);
            --shadow-lg: 0 4px 6px rgba(0,0,0,0.07);
        }

        [data-theme="dark"] {
            --bg-primary: #1a202c;
            --bg-secondary: #2d3748;
            --bg-tertiary: #4a5568;
            --text-primary: #f7fafc;
            --text-secondary: #cbd5e0;
            --text-muted: #718096;
            --border: #4a5568;
            --accent: #63b3ed;
            --accent-hover: #4299e1;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .toolbar {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            box-shadow: var(--shadow);
            z-index: 100;
        }

        .toolbar-group {
            display: flex;
            gap: 4px;
            align-items: center;
            padding: 0 12px;
            border-right: 1px solid var(--border);
        }

        .toolbar-group:last-child {
            border-right: none;
        }

        .toolbar-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 8px;
            cursor: pointer;
            border-radius: 6px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            transition: all 0.2s ease;
            position: relative;
        }

        .toolbar-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .toolbar-btn.active {
            background: var(--accent);
            color: white;
        }

        .toolbar-btn svg {
            width: 18px;
            height: 18px;
        }

        .layout-switcher {
            display: flex;
            gap: 2px;
            background: var(--bg-tertiary);
            padding: 2px;
            border-radius: 6px;
        }

        .layout-btn {
            padding: 6px 10px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .layout-btn.active {
            background: var(--bg-primary);
            color: var(--accent);
        }

        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .editor-container, .preview-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .pane-header {
            background: var(--bg-secondary);
            padding: 10px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .editor-textarea {
            flex: 1;
            padding: 20px;
            border: none;
            outline: none;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-size: 14px;
            line-height: 1.7;
            resize: none;
            overflow-y: auto;
        }

        .preview-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: var(--bg-primary);
        }

        .preview-content h1 { 
            font-size: 2em; 
            font-weight: 700;
            margin-top: 0;
            margin-bottom: 0.6em;
            color: var(--text-primary);
            line-height: 1.3;
        }

        .preview-content h2 { 
            font-size: 1.5em; 
            font-weight: 600;
            margin-top: 2em;
            margin-bottom: 0.5em;
            color: var(--text-primary);
        }

        .preview-content h3 { 
            font-size: 1.25em; 
            font-weight: 600;
            margin-top: 1.5em;
            margin-bottom: 0.4em;
            color: var(--text-primary);
        }

        .preview-content h4, 
        .preview-content h5, 
        .preview-content h6 { 
            font-size: 1em; 
            font-weight: 600;
            margin-top: 1.2em;
            margin-bottom: 0.3em;
            color: var(--text-primary);
        }

        .preview-content p {
            margin-bottom: 1.2em;
            line-height: 1.7;
            color: var(--text-primary);
        }

        .preview-content ul, 
        .preview-content ol {
            margin-bottom: 1.2em;
            padding-left: 1.5em;
        }

        .preview-content li {
            margin-bottom: 0.4em;
            line-height: 1.6;
        }

        .preview-content blockquote {
            margin: 1.5em 0;
            padding: 0.8em 1.2em;
            border-left: 3px solid var(--accent);
            background: var(--bg-secondary);
            color: var(--text-secondary);
            font-style: italic;
            border-radius: 0 4px 4px 0;
        }

        .preview-content code {
            background: var(--bg-tertiary);
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: 'SF Mono', 'Monaco', monospace;
            font-size: 0.85em;
            color: var(--text-primary);
        }

        .preview-content pre {
            background: var(--bg-tertiary);
            padding: 1.2em;
            border-radius: 6px;
            overflow-x: auto;
            margin: 1.5em 0;
        }

        .preview-content pre code {
            background: none;
            padding: 0;
            font-size: 0.9em;
        }

        .preview-content table {
            border-collapse: collapse;
            width: 100%;
            margin: 1.5em 0;
            font-size: 0.95em;
        }

        .preview-content th, 
        .preview-content td {
            border: 1px solid var(--border);
            padding: 0.8em 1em;
            text-align: left;
        }

        .preview-content th {
            background: var(--bg-secondary);
            font-weight: 600;
            color: var(--text-primary);
        }

        .preview-content a {
            color: var(--accent);
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .preview-content a:hover {
            color: var(--accent-hover);
            text-decoration: underline;
        }

        .preview-content img {
            max-width: 100%;
            height: auto;
            border-radius: 6px;
            margin: 1.5em 0;
        }

        .preview-content hr {
            border: none;
            border-top: 1px solid var(--border);
            margin: 2em 0;
        }

        .stats-bar {
            background: var(--bg-secondary);
            padding: 8px 20px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 24px;
            font-size: 13px;
            color: var(--text-muted);
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .stat-item svg {
            width: 14px;
            height: 14px;
        }

        .help-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 24px;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            display: none;
        }

        .help-panel.active {
            display: block;
        }

        .help-panel h2 {
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .help-section {
            margin-bottom: 20px;
        }

        .help-section h3 {
            margin-bottom: 8px;
            color: var(--accent);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .help-section table {
            width: 100%;
            font-size: 13px;
        }

        .help-section td {
            padding: 6px;
            border-bottom: 1px solid var(--border);
        }

        .help-section td:first-child {
            font-family: 'SF Mono', 'Monaco', monospace;
            background: var(--bg-tertiary);
            border-radius: 3px;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.4);
            z-index: 999;
            display: none;
            backdrop-filter: blur(2px);
        }

        .modal-overlay.active {
            display: block;
        }

        .toc {
            background: var(--bg-secondary);
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .toc h3 {
            margin-bottom: 12px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
        }

        .toc ul {
            list-style-type: none;
            padding-left: 0;
        }

        .toc li {
            margin-bottom: 6px;
        }

        .toc a {
            color: var(--accent);
            text-decoration: none;
            font-size: 14px;
            transition: color 0.2s ease;
        }

        .toc a:hover {
            color: var(--accent-hover);
        }

        .layout-vertical {
            flex-direction: column;
        }

        .layout-vertical .editor-container,
        .layout-vertical .preview-container {
            width: 100%;
            height: 50%;
        }

        .layout-preview-only .editor-container {
            display: none;
        }

        .layout-editor-only .preview-container {
            display: none;
        }

        .find-replace {
            background: var(--bg-secondary);
            padding: 12px 20px;
            border-bottom: 1px solid var(--border);
            display: none;
            gap: 12px;
            align-items: center;
        }

        .find-replace.active {
            display: flex;
        }

        .find-replace input {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s ease;
        }

        .find-replace input:focus {
            border-color: var(--accent);
        }

        .find-replace button {
            padding: 8px 16px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: background-color 0.2s ease;
        }

        .find-replace button:hover {
            background: var(--accent-hover);
        }

        input[type="file"] {
            display: none;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--accent);
            color: white;
            padding: 12px 16px;
            border-radius: 6px;
            box-shadow: var(--shadow-lg);
            z-index: 10000;
            animation: slideIn 0.3s ease;
            font-size: 14px;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        @media (max-width: 768px) {
            .toolbar {
                padding: 8px 12px;
            }
            
            .toolbar-group {
                padding: 0 4px;
            }
            
            .toolbar-btn {
                width: 32px;
                height: 32px;
            }
            
            .toolbar-btn svg {
                width: 16px;
                height: 16px;
            }
            
            .layout-switcher {
                display: none;
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="toolbar">
            <div class="toolbar-group">
                <button class="toolbar-btn" onclick="formatText('bold')" title="Bold">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M13.5,15.5H10V12.5H13.5A1.5,1.5 0 0,1 15,14A1.5,1.5 0 0,1 13.5,15.5M10,6.5H13A1.5,1.5 0 0,1 14.5,8A1.5,1.5 0 0,1 13,9.5H10M15.6,10.79C16.57,10.11 17.25,9 17.25,8C17.25,5.74 15.5,4 13.25,4H7V18H14.04C16.14,18 17.75,16.3 17.75,14.21C17.75,12.69 16.89,11.39 15.6,10.79Z"/></svg>
                </button>
                <button class="toolbar-btn" onclick="formatText('italic')" title="Italic">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M10,4V7H12.21L8.79,15H6V18H14V15H11.79L15.21,7H18V4H10Z"/></svg>
                </button>
                <button class="toolbar-btn" onclick="formatText('heading')" title="Heading">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M3,3H9V7H5V10H9V21H3V10H1V7H3V3M11,3H17V7H13V21H11V3M19,3H21V7H19V21H17V7H15V3H19Z"/></svg>
                </button>
                <button class="toolbar-btn" onclick="formatText('quote')" title="Quote">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M14,17H17L19,13V7H13V13H16M6,17H9L11,13V7H5V13H8L6,17Z"/></svg>
                </button>
                <button class="toolbar-btn" onclick="formatText('code')" title="Code">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M14.6,16.6L19.2,12L14.6,7.4L16,6L22,12L16,18L14.6,16.6M9.4,16.6L4.8,12L9.4,7.4L8,6L2,12L8,18L9.4,16.6Z"/></svg>
                </button>
                <button class="toolbar-btn" onclick="formatText('link')" title="Link">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M10.59,13.41C11,13.8 11,14.44 10.59,14.83C10.2,15.22 9.56,15.22 9.17,14.83C7.22,12.88 7.22,9.71 9.17,7.76V7.76L12.71,4.22C14.66,2.27 17.83,2.27 19.78,4.22C21.73,6.17 21.73,9.34 19.78,11.29L18.29,12.78C18.3,11.96 18.17,11.14 17.89,10.36L18.36,9.88C19.54,8.71 19.54,6.81 18.36,5.64C17.19,4.46 15.29,4.46 14.12,5.64L10.59,9.17C9.41,10.34 9.41,12.24 10.59,13.41M13.41,9.17C13.8,8.78 14.44,8.78 14.83,9.17C16.78,11.12 16.78,14.29 14.83,16.24V16.24L11.29,19.78C9.34,21.73 6.17,21.73 4.22,19.78C2.27,17.83 2.27,14.66 4.22,12.71L5.71,11.22C5.7,12.04 5.83,12.86 6.11,13.65L5.64,14.12C4.46,15.29 4.46,17.19 5.64,18.36C6.81,19.54 8.71,19.54 9.88,18.36L13.41,14.83C14.59,13.66 14.59,11.76 13.41,10.59C13,10.2 13,9.56 13.41,9.17Z"/></svg>
                </button>
                <button class="toolbar-btn" onclick="formatText('image')" title="Image">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"/></svg>
                </button>
                <button class="toolbar-btn" onclick="formatText('list')" title="List">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M3,4H7V8H3V4M9,5V7H21V5H9M3,10H7V14H3V10M9,11V13H21V11H9M3,16H7V20H3V16M9,17V19H21V17H9"/></svg>
                </button>
                <button class="toolbar-btn" onclick="formatText('table')" title="Table">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M3,3H21V21H3V3M5,5V19H19V5H5M7,7H9V9H7V7M11,7H17V9H11V7M7,11H9V13H7V11M11,11H17V13H11V11M7,15H9V17H7V15M11,15H17V17H11V15Z"/></svg>
                </button>
            </div>

            <div class="toolbar-group">
                <button class="toolbar-btn" onclick="undo()" title="Undo">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M12.5,8C9.85,8 7.45,9 5.6,10.6L2,7V16H11L7.38,12.38C8.77,11.22 10.54,10.5 12.5,10.5C16.04,10.5 19.05,12.81 20.1,16L22.47,15.22C21.08,11.03 17.15,8 12.5,8Z"/></svg>
                </button>
                <button class="toolbar-btn" onclick="redo()" title="Redo">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M18.4,10.6C16.55,9 14.15,8 11.5,8C6.85,8 2.92,11.03 1.54,15.22L3.9,16C4.95,12.81 7.95,10.5 11.5,10.5C13.45,10.5 15.23,11.22 16.62,12.38L13,16H22V7L18.4,10.6Z"/></svg>
                </button>
            </div>

            <div class="toolbar-group">
                <button class="toolbar-btn" onclick="toggleFindReplace()" title="Find & Replace">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/></svg>
                </button>
            </div>

            <div class="toolbar-group">
                <div class="layout-switcher">
                    <button class="layout-btn active" onclick="setLayout('split')" title="Split View">
                        <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M3,3H21V21H3V3M5,5V19H11V5H5M13,5V19H19V5H13Z"/></svg>
                    </button>
                    <button class="layout-btn" onclick="setLayout('vertical')" title="Vertical Split">
                        <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M3,3H21V21H3V3M5,5V11H19V5H5M5,13V19H19V13H5Z"/></svg>
                    </button>
                    <button class="layout-btn" onclick="setLayout('preview')" title="Preview Only">
                        <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5M12,17C9.24,17 7,14.76 7,12C7,9.24 9.24,7 12,7C14.76,7 17,9.24 17,12C17,14.76 14.76,17 12,17M12,9C10.34,9 9,10.34 9,12C9,13.66 10.34,15 12,15C13.66,15 15,13.66 15,12C15,10.34 13.66,9 12,9Z"/></svg>
                    </button>
                    <button class="layout-btn" onclick="setLayout('editor')" title="Editor Only">
                        <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M14.6,16.6L19.2,12L14.6,7.4L16,6L22,12L16,18L14.6,16.6M9.4,16.6L4.8,12L9.4,7.4L8,6L2,12L8,18L9.4,16.6Z"/></svg>
                    </button>
                </div>
            </div>

            <div class="toolbar-group">
                <button class="toolbar-btn" onclick="copyMarkdown()" title="Copy Markdown">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg>
                </button>
                <button class="toolbar-btn" onclick="copyHTML()" title="Copy HTML">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M9,4H15V12H19.84L12,19.84L4.16,12H9V4Z"/></svg>
                </button>
                <button class="toolbar-btn" onclick="downloadMarkdown()" title="Download Markdown">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"/></svg>
                </button>
                <button class="toolbar-btn" onclick="downloadHTML()" title="Download HTML">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M14,2L20,8V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V4A2,2 0 0,1 6,2H14M18,20V9H13V4H6V20H18M12,19L8,15H10.5V12H13.5V15H16L12,19Z"/></svg>
                </button>
                <button class="toolbar-btn" onclick="document.getElementById('fileInput').click()" title="Import File">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M14,13V17H10V13H7L12,8L17,13M19.35,10.03C18.67,6.59 15.64,4 12,4C9.11,4 6.6,5.64 5.35,8.03C2.34,8.36 0,10.9 0,14A6,6 0 0,0 6,20H19A5,5 0 0,0 24,15C24,12.36 21.95,10.22 19.35,10.03Z"/></svg>
                </button>
                <input type="file" id="fileInput" accept=".md,.markdown,.txt" onchange="importFile(event)">
            </div>

            <div class="toolbar-group">
                <button class="toolbar-btn" onclick="printDocument()" title="Print/PDF">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M18,3H6V7H18M19,12A1,1 0 0,1 18,11A1,1 0 0,1 19,10A1,1 0 0,1 20,11A1,1 0 0,1 19,12M18,7H6V19H18V7M19,8H21V16H19V8M3,8H5V16H3V8M10,17H14V18H10V17Z"/></svg>
                </button>
                <button class="toolbar-btn" onclick="clearAll()" title="Clear">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/></svg>
                </button>
                <button class="toolbar-btn" onclick="toggleHelp()" title="Help">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M11,18H13V16H11V18M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,6A4,4 0 0,0 8,10H10A2,2 0 0,1 12,8A2,2 0 0,1 14,10C14,12 11,11.75 11,15H13C13,12.75 16,12.5 16,10A4,4 0 0,0 12,6Z"/></svg>
                </button>
                <button class="toolbar-btn" onclick="toggleTheme()" title="Toggle Theme">
                    <svg fill="currentColor" viewBox="0 0 24 24" id="themeIcon"><path d="M12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18M20,15.31L23.31,12L20,8.69V4H15.31L12,0.69L8.69,4H4V8.69L0.69,12L4,15.31V20H8.69L12,23.31L15.31,20H20V15.31Z"/></svg>
                </button>
            </div>
        </div>

        <div class="find-replace" id="findReplace">
            <input type="text" placeholder="Find..." id="findInput">
            <input type="text" placeholder="Replace with..." id="replaceInput">
            <button onclick="findNext()">Next</button>
            <button onclick="replaceAll()">Replace All</button>
        </div>

        <div class="main-content" id="mainContent">
            <div class="editor-container">
                <div class="pane-header">
                    <span>Markdown</span>
                    <span id="cursorPosition">Ln 1, Col 1</span>
                </div>
                <textarea class="editor-textarea" id="editor" placeholder="Start typing..."></textarea>
            </div>
            <div class="preview-container">
                <div class="pane-header">
                    <span>Preview</span>
                    <button class="toolbar-btn" onclick="toggleTOC()" title="Toggle TOC">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z"/></svg>
                    </button>
                </div>
                <div class="preview-content" id="preview"></div>
            </div>
        </div>

        <div class="stats-bar">
            <div class="stat-item">
                <svg fill="currentColor" viewBox="0 0 24 24"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/></svg>
                <span><span id="wordCount">0</span> words</span>
            </div>
            <div class="stat-item">
                <svg fill="currentColor" viewBox="0 0 24 24"><path d="M9.62,12L12,5.67L14.37,12M11,3L5.5,17H7.75L8.87,14H15.12L16.25,17H18.5L13,3H11Z"/></svg>
                <span><span id="charCount">0</span> characters</span>
            </div>
            <div class="stat-item">
                <svg fill="currentColor" viewBox="0 0 24 24"><path d="M3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3H5A2,2 0 0,0 3,5M5,5H19V19H5V5M7,7V9H10V7H7M12,7V9H17V7H12M7,11V13H10V11H7M12,11V13H17V11H12M7,15V17H14V15H7Z"/></svg>
                <span><span id="paraCount">0</span> paragraphs</span>
            </div>
            <div class="stat-item">
                <svg fill="currentColor" viewBox="0 0 24 24"><path d="M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"/></svg>
                <span><span id="readTime">0</span> min read</span>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modalOverlay" onclick="toggleHelp()"></div>
    <div class="help-panel" id="helpPanel">
        <h2>Markdown Syntax</h2>
        
        <div class="help-section">
            <h3>Text Formatting</h3>
            <table>
                <tr><td>**bold**</td><td>Bold text</td></tr>
                <tr><td>*italic*</td><td>Italic text</td></tr>
                <tr><td>~~strike~~</td><td>Strikethrough</td></tr>
            </table>
        </div>

        <div class="help-section">
            <h3>Headings</h3>
            <table>
                <tr><td># H1</td><td>Level 1 heading</td></tr>
                <tr><td>## H2</td><td>Level 2 heading</td></tr>
                <tr><td>### H3</td><td>Level 3 heading</td></tr>
            </table>
        </div>

        <div class="help-section">
            <h3>Links & Images</h3>
            <table>
                <tr><td>[text](url)</td><td>Link</td></tr>
                <tr><td>![alt](img)</td><td>Image</td></tr>
            </table>
        </div>

        <div class="help-section">
            <h3>Lists</h3>
            <table>
                <tr><td>- item</td><td>Bulleted list</td></tr>
                <tr><td>1. item</td><td>Numbered list</td></tr>
            </table>
        </div>

        <div class="help-section">
            <h3>Code</h3>
            <table>
                <tr><td>`code`</td><td>Inline code</td></tr>
                <tr><td>```block```</td><td>Code block</td></tr>
            </table>
        </div>

        <button class="toolbar-btn" onclick="toggleHelp()" style="margin-top: 20px; width: 100%;">
            Close
        </button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        const editor = document.getElementById('editor');
        const preview = document.getElementById('preview');
        const mainContent = document.getElementById('mainContent');
        let history = [];
        let historyIndex = -1;
        let currentLayout = 'split';
        let showTOC = false;

        marked.setOptions({
            highlight: function(code, lang) {
                if (lang && hljs.getLanguage(lang)) {
                    return hljs.highlight(code, { language: lang }).value;
                }
                return hljs.highlightAuto(code).value;
            },
            breaks: true,
            gfm: true
        });

        function updatePreview() {
            const markdown = editor.value;
            let html = marked.parse(markdown);
            
            if (showTOC) {
                const toc = generateTOC(markdown);
                html = toc + html;
            }
            
            preview.innerHTML = html;
        }

        function generateTOC(markdown) {
            const headings = markdown.match(/^#{1,6}\s+(.+)$/gm);
            if (!headings) return '';

            let toc = '<div class="toc"><h3>Contents</h3><ul>';
            headings.forEach(heading => {
                const level = heading.match(/^#/)[0].length;
                const text = heading.replace(/^#+\s+/, '');
                const id = text.toLowerCase().replace(/[^\w]+/g, '-');
                toc += `<li style="margin-left: ${(level - 2) * 15}px"><a href="#${id}">${text}</a></li>`;
            });
            toc += '</ul></div>';
            return toc;
        }

        function formatText(type) {
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const selectedText = editor.value.substring(start, end);
            let newText = '';
            let prefix = '';
            let suffix = '';

            switch(type) {
                case 'bold': prefix = '**'; suffix = '**'; break;
                case 'italic': prefix = '*'; suffix = '*'; break;
                case 'heading': prefix = '\n## '; suffix = '\n'; break;
                case 'quote': prefix = '> '; suffix = '\n'; break;
                case 'code': prefix = '`'; suffix = '`'; break;
                case 'link': newText = `[${selectedText || 'Link Text'}](url)`; break;
                case 'image': newText = `![${selectedText || 'Alt Text'}](image-url)`; break;
                case 'list': prefix = '- '; suffix = '\n'; break;
                case 'table': newText = '\n| Col | Col |\n|-----|-----|\n| 1   | 2   |\n'; break;
            }

            if (newText) {
                editor.value = editor.value.substring(0, start) + newText + editor.value.substring(end);
                editor.selectionStart = start;
                editor.selectionEnd = start + newText.length;
            } else {
                newText = prefix + selectedText + suffix;
                editor.value = editor.value.substring(0, start) + newText + editor.value.substring(end);
                editor.selectionStart = start + prefix.length;
                editor.selectionEnd = start + prefix.length + selectedText.length;
            }

            editor.focus();
            updatePreview();
            updateStats();
            saveHistory();
        }

        function updateStats() {
            const text = editor.value;
            const words = text.trim() ? text.trim().split(/\s+/).length : 0;
            const chars = text.length;
            const paragraphs = text.trim() ? text.trim().split(/\n\n+/).length : 0;
            const readTime = Math.ceil(words / 200);

            document.getElementById('wordCount').textContent = words;
            document.getElementById('charCount').textContent = chars;
            document.getElementById('paraCount').textContent = paragraphs;
            document.getElementById('readTime').textContent = readTime;
        }

        function updateCursorPosition() {
            const pos = editor.selectionStart;
            const lines = editor.value.substring(0, pos).split('\n');
            const row = lines.length;
            const col = lines[lines.length - 1].length + 1;
            document.getElementById('cursorPosition').textContent = `Ln ${row}, Col ${col}`;
        }

        function saveHistory() {
            const current = editor.value;
            if (history[historyIndex] !== current) {
                history = history.slice(0, historyIndex + 1);
                history.push(current);
                historyIndex++;
                if (history.length > 50) {
                    history.shift();
                    historyIndex--;
                }
            }
        }

        function undo() {
            if (historyIndex > 0) {
                historyIndex--;
                editor.value = history[historyIndex];
                updatePreview();
                updateStats();
                updateCursorPosition();
            }
        }

        function redo() {
            if (historyIndex < history.length - 1) {
                historyIndex++;
                editor.value = history[historyIndex];
                updatePreview();
                updateStats();
                updateCursorPosition();
            }
        }

        function toggleFindReplace() {
            const findReplace = document.getElementById('findReplace');
            findReplace.classList.toggle('active');
            if (findReplace.classList.contains('active')) {
                document.getElementById('findInput').focus();
            }
        }

        function findNext() {
            const findText = document.getElementById('findInput').value;
            if (!findText) return;

            const text = editor.value;
            const index = text.indexOf(findText, editor.selectionEnd);
            
            if (index !== -1) {
                editor.selectionStart = index;
                editor.selectionEnd = index + findText.length;
                editor.focus();
            }
        }

        function replaceAll() {
            const findText = document.getElementById('findInput').value;
            const replaceText = document.getElementById('replaceInput').value;
            
            if (!findText) return;
            
            editor.value = editor.value.replaceAll(findText, replaceText);
            updatePreview();
            updateStats();
            saveHistory();
        }

        function setLayout(layout) {
            currentLayout = layout;
            mainContent.classList.remove('layout-vertical', 'layout-preview-only', 'layout-editor-only');
            
            document.querySelectorAll('.layout-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.layout-btn').classList.add('active');
            
            switch(layout) {
                case 'vertical': mainContent.classList.add('layout-vertical'); break;
                case 'preview': mainContent.classList.add('layout-preview-only'); break;
                case 'editor': mainContent.classList.add('layout-editor-only'); break;
            }
        }

        function copyMarkdown() {
            navigator.clipboard.writeText(editor.value).then(() => {
                showNotification('Markdown copied!');
            });
        }

        function copyHTML() {
            navigator.clipboard.writeText(preview.innerHTML).then(() => {
                showNotification('HTML copied!');
            });
        }

        function downloadMarkdown() {
            const content = editor.value;
            const blob = new Blob([content], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'document.md';
            a.click();
            URL.revokeObjectURL(url);
            showNotification('Markdown downloaded!');
        }

        function downloadHTML() {
            const content = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.6; }
        h1, h2, h3 { margin-top: 1.5em; margin-bottom: 0.5em; }
        code { background: #f4f4f4; padding: 2px 4px; border-radius: 3px; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 5px; overflow-x: auto; }
        blockquote { border-left: 4px solid #ddd; margin: 0; padding-left: 20px; color: #666; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    </style>
</head>
<body>
${preview.innerHTML}
</body>
</html>`;
            const blob = new Blob([content], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'document.html';
            a.click();
            URL.revokeObjectURL(url);
            showNotification('HTML downloaded!');
        }

        function importFile(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    editor.value = e.target.result;
                    updatePreview();
                    updateStats();
                    saveHistory();
                    showNotification('File imported!');
                };
                reader.readAsText(file);
            }
        }

        function printDocument() {
            window.print();
        }

        function clearAll() {
            if (confirm('Clear all content?')) {
                editor.value = '';
                updatePreview();
                updateStats();
                saveHistory();
            }
        }

        function toggleHelp() {
            const helpPanel = document.getElementById('helpPanel');
            const modalOverlay = document.getElementById('modalOverlay');
            helpPanel.classList.toggle('active');
            modalOverlay.classList.toggle('active');
        }

        function toggleTOC() {
            showTOC = !showTOC;
            updatePreview();
        }

        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('themeIcon');
            
            if (body.hasAttribute('data-theme')) {
                body.removeAttribute('data-theme');
                themeIcon.innerHTML = '<path d="M12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18M20,15.31L23.31,12L20,8.69V4H15.31L12,0.69L8.69,4H4V8.69L0.69,12L4,15.31V20H8.69L12,23.31L15.31,20H20V15.31Z"/>';
            } else {
                body.setAttribute('data-theme', 'dark');
                themeIcon.innerHTML = '<path d="M17.75,4.09L15.22,6.03L16.13,9.09L13.5,7.28L10.87,9.09L11.78,6.03L9.25,4.09L12.44,4L13.5,1L14.56,4L17.75,4.09M21.25,11L19.61,12.25L20.2,14.23L18.5,13.06L16.8,14.23L17.39,12.25L15.75,11L17.81,10.95L18.5,9L19.19,10.95L21.25,11M18.97,15.95C19.8,15.87 20.69,17.05 20.16,17.8C19.84,18.25 19.5,18.67 19.08,19.07C15.17,23 8.84,23 4.94,19.07C1.03,15.17 1.03,8.83 4.94,4.93C5.34,4.53 5.76,4.17 6.21,3.85C6.96,3.32 8.14,4.21 8.06,5.04C7.79,7.9 8.75,10.87 10.95,13.06C13.14,15.26 16.1,16.22 18.97,15.95M17.33,17.97C14.5,17.81 11.7,16.64 9.53,14.5C7.36,12.31 6.2,9.5 6.04,6.68C3.23,9.82 3.34,14.64 6.35,17.66C9.37,20.67 14.19,20.78 17.33,17.97Z"/>';
            }
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Event listeners
        editor.addEventListener('input', () => {
            updatePreview();
            updateStats();
            saveHistory();
            updateCursorPosition();
        });

        editor.addEventListener('keyup', updateCursorPosition);
        editor.addEventListener('click', updateCursorPosition);

        editor.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'z': e.preventDefault(); undo(); break;
                    case 'y': e.preventDefault(); redo(); break;
                    case 's': e.preventDefault(); downloadMarkdown(); break;
                    case 'f': e.preventDefault(); toggleFindReplace(); break;
                }
            }
        });

        // Initialize with sample content
        editor.value = `# Beautiful Markdown

Clean and minimal markdown editor with live preview.

## Features

- **Live preview** with syntax highlighting
- **Dark mode** for comfortable writing
- **Export** to Markdown and HTML
- **Statistics** tracking

> "Simplicity is the ultimate sophistication."

### Code Example

\`\`\`javascript
function hello() {
    console.log("Hello, World!");
}
\`\`\`

| Feature | Status |
|---------|--------|
| Editor  | ✅     |
| Preview | ✅     |
| Export  | ✅     |

---

Start writing your markdown here!`;
        updatePreview();
        updateStats();
        saveHistory();
    </script>
</body>
</html>
